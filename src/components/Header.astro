---
import Logo from "./MeeLogo.astro";
import ButtonLink, { type ButtonType, type Style } from "./ButtonLink.astro";
import IconButton from "./IconButton.astro";
export interface Props {
  className?: string;
  type?: "default" | "docs" | "dark";
  activePage?: string;
  location?: string;
  disableMobileMenu?: boolean;
  header: {
    links: Link[];
    rightLinks: RigthLink[];
    footerLinks: Link[];
    logoLink?: string;
    userLinks?: UserLinks[];
  };
}

interface Link {
  name: string;
  link: string;
  id: string;
  target?: string;
}

interface RigthLink {
  name: string;
  link: string;
  target?: string;
  id?: string;
  icon?: string;
  buttonType?: ButtonType;
  style?: Style;
}
interface UserLinks extends RigthLink {
  className?: string;
}
const {
  className,
  activePage,
  type = "default",
  header,
  location,
  disableMobileMenu,
} = Astro.props;
---

<div class:list={["group relative transition-all", `type-${type}`]}>
  <header
    id="header"
    class:list={[
      "fixed left-0 top-0 z-300 flex h-27 w-screen items-center justify-center transition-all duration-300",
      "group-[.type-docs]:border-b group-[.type-docs]:border-grey-200",
      "group-[.type-default]:bg-white group-[.type-default]:bg-header-bg group-[.type-default]:backdrop-blur-62.5 group-[.type-default]:transition-all group-[.type-default]:duration-300",
      "group-[.type-docs]:bg-white group-[.type-docs]:bg-header-bg group-[.type-docs]:backdrop-blur-62.5 group-[.type-docs]:transition-all group-[.type-docs]:duration-300",
    ]}
    data-type={type}
  >
    <div
      class:list={[
        "header mx-auto flex max-w-7xl items-center justify-between px-5",
        "group-[.type-default]:w-full group-[.type-default]:flex-wrap",
        "group-[.type-docs]:w-full group-[.type-docs]:flex-wrap",
        "group-[.type-dark]:gap-10 group-[.type-dark]:rounded-2.5xl group-[.type-dark]:border group-[.type-dark]:border-white/15 group-[.type-dark]:bg-header-bg-dark group-[.type-dark]:py-2 group-[.type-dark]:shadow-header group-[.type-dark]:backdrop-blur-12.5",
        className,
      ]}
    >
      <div
        class:list={[
          "flex items-center gap-2 group-[.type-default]:w-1/3 group-[.type-docs]:w-1/3",
        ]}
      >
        <div>
          <a
            id="mainLogo"
            href={header.logoLink ? header.logoLink : "/"}
            class="logo flex h-6 w-20 items-center justify-center"
          >
            <Logo className="group-[.type-dark]:!fill-white" />
          </a>
        </div>
        {
          location && (
            <div class="flex whitespace-nowrap text-nowrap rounded-full border border-brand-300 bg-brand-50 px-1.5 py-0.5 text-sm font-semibold text-brand-700 md:hidden">
              {location}
            </div>
          )
        }
      </div>
      <ul
        class:list={[
          "items-right hidden justify-center gap-2 whitespace-nowrap text-center group-[.type-default]:w-1/3 group-[.type-docs]:w-1/3 md:flex",
        ]}
      >
        {
          header.links.map((link) => (
            <li
              class:list={[
                "text-base font-semibold text-brand-950",
                "group-[.type-dark]:!text-white/90",
              ]}
            >
              <a
                href={link.link}
                target={link.target}
                class:list={[
                  "rounded-2xl px-4 py-1.5",
                  "group-[.type-default]:hover:bg-primary group-[.type-default]:hover:text-white",
                  "group-[.type-docs]:hover:bg-primary group-[.type-docs]:hover:text-white",
                  "group-[.type-dark]:hover:text-white group-[.type-dark]:hover:underline",
                  activePage === link.id &&
                    "group-[.type-default]:bg-primary group-[.type-docs]:bg-primary group-[.type-default]:text-white group-[.type-docs]:text-white",
                  activePage === link.id && "group-[.type-dark]:text-white",
                ]}
              >
                {link.name}
              </a>
            </li>
          ))
        }
      </ul>
      <div
        class:list={[
          "hidden items-end justify-end gap-3 group-[.type-default]:w-1/3 group-[.type-docs]:w-1/3 md:flex",
        ]}
      >
        {
          header.rightLinks.map((link) => (
            <ButtonLink
              leftIcon={`${link.icon} text-lg`}
              buttonType="tertiary"
              buttonType="tertiary"
              style="outlined"
              size="l"
              href={link.link}
              target={link.target}
              className="group-[.type-dark]:hidden"
            >
              {link.name}
            </ButtonLink>
          ))
        }
        {
          header.rightLinks.map((link) => (
            <ButtonLink
              leftIcon={`${link.icon} text-lg`}
              buttonType="tertiary"
              buttonType={"primary"}
              style={"transparent"}
              size="l"
              href={link.link}
              target={link.target}
              className="group-[.type-default]:hidden group-[.type-docs]:hidden border-none !text-white/90"
            />
          ))
        }
        {
          header.userLinks?.map((link) => (
            <ButtonLink
              leftIcon={link.icon && `${link.icon} text-lg`}
              buttonType={link.buttonType ?? "tertiary"}
              style={link.style ?? "outlined"}
              size="l"
              href={link.link}
              target={link.target}
              className={link.className}
            >
              {link.name}
            </ButtonLink>
          ))
        }
      </div>
      <div
        class:list={[
          "flex items-center justify-end gap-1 group-[.type-default]:w-1/3 group-[.type-docs]:w-1/3 md:hidden",
        ]}
      >
        {
          !location &&
            header.rightLinks.map((link) => (
              <ButtonLink
                leftIcon={`${link.icon} text-lg`}
                buttonType="tertiary"
                buttonType={"tertiary"}
                style="transparent"
                size="l"
                href={link.link}
                target={link.target}
                className="border-none  group-[.type-dark]:hidden"
              />
            ))
        }
        {
          !location &&
            header.rightLinks.map((link) => (
              <ButtonLink
                leftIcon={`${link.icon} text-lg`}
                buttonType="tertiary"
                buttonType={"primary"}
                style="transparent"
                size="l"
                href={link.link}
                target={link.target}
                className="border-none !text-white/90 group-[.type-default]:hidden group-[.type-docs]:hidden"
              />
            ))
        }
        {
          header.userLinks?.map((link) => (
            <ButtonLink
              leftIcon={link.icon && `${link.icon} text-lg`}
              buttonType={link.buttonType ?? "tertiary"}
              style={link.style ?? "outlined"}
              size="l"
              href={link.link}
              target={link.target}
              className={link.className}
            >
              {link.name}
            </ButtonLink>
          ))
        }

        {
          !disableMobileMenu && (
            <IconButton
              icon="list"
              buttonType="tertiary"
              style="transparent"
              size="m"
              className="border-none group-[.type-dark]:!text-white"
              id="open-menu"
            />
          )
        }
      </div>
    </div>
    <div
      class="group-[.type-default]:absolute group-[.type-default]:bottom-0 group-[.type-default]:left-0 group-[.type-default]:right-0 group-[.type-default]:h-px group-[.type-default]:w-full group-[.type-default]:bg-header-gradient"
    >
    </div>
  </header>
  <div class="relative" id="mobile-header">
    <div
      class="fixed right-0 top-0 z-300 h-screen w-0 overflow-hidden bg-white transition-all duration-400 md:hidden"
      id="menu"
    >
      <div
        class="flex h-screen w-full flex-col justify-between py-9 text-brand-950"
      >
        <div
          class:list={[
            "mx-auto flex w-full max-w-7xl flex-wrap items-center justify-between px-5",
          ]}
        >
          <a id="mainLogo" href="/" class="logo block h-6 w-20">
            <Logo />
          </a>
          <IconButton
            icon="x-lg"
            size="s"
            buttonType="tertiary"
            style="transparent"
            className="border-none"
            id="close-menu"
          />
        </div>
        <ul class="items-right flex flex-col justify-center gap-4 text-center">
          {
            header.links.map((link) => (
              <li class="text-lg font-semibold">
                <a
                  href={link.link}
                  target={link.target}
                  class:list={[
                    "rounded-2xl px-4 py-1.5",
                    type !== "dark" && "hover:bg-primary hover:text-white",
                    type === "dark" && "hover:text-white hover:underline",
                    type !== "dark" &&
                      activePage === link.id &&
                      "bg-primary text-white",
                    type === "dark" && activePage === link.id && "text-white",
                  ]}
                >
                  {link.name}
                </a>
              </li>
            ))
          }
        </ul>
        <div class="flex flex-col gap-3">
          <ul class="flex flex-row justify-center gap-7 text-center">
            {
              header.rightLinks.map((link) => (
                <li>
                  <a href={link.link} target={link.target}>
                    {link.icon && (
                      <i
                        class:list={[
                          "bi text-3xl font-thin",
                          "bi-" + link.icon,
                        ]}
                      />
                    )}
                  </a>
                </li>
              ))
            }
          </ul>
          <div class="after-border relative h-1"></div>
          <ul
            class="flex flex-row justify-center gap-7 text-center text-grey-700"
          >
            {
              header.footerLinks.map((link) => (
                <li class="text-sm">
                  <a href={link.link} target={link.target}>
                    {link.name}
                  </a>
                </li>
              ))
            }
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .after-border:after {
    @apply absolute bottom-0 left-0 right-0 h-px w-full bg-header-gradient content-[''];
  }
</style>

<script>
  const header = document.getElementById("header") as HTMLElement;
  const menu = document.getElementById("menu") as HTMLElement;
  const openMenu = document.getElementById("open-menu") as HTMLButtonElement;
  const closeMenu = document.getElementById("close-menu") as HTMLButtonElement;
  document.addEventListener("scroll", () => {
    if (header.dataset.type !== "dark") {
      if (window.scrollY > 50) {
        header.classList.remove("h-27");
        header.classList.add("h-17");
      } else {
        header.classList.remove("h-17");
        header.classList.add("h-27");
      }
    }
  });

  openMenu?.addEventListener("click", () => {
    document.body.classList.add("h-screen", "overflow-hidden");
    menu.classList.remove("w-0");
    menu.classList.add("w-screen");
  });
  closeMenu?.addEventListener("click", () => {
    menu.classList.add("w-0");
    menu.classList.remove("w-screen");
    document.body.classList.remove("h-screen", "overflow-hidden");
  });
</script>
